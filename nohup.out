 _                     _    _             
| |__  _ __ ___   ___ | | _| |_   _ _ __ (R)
| '_ \| '__/ _ \ / _ \| |/ / | | | | '_ \ 
| |_) | | | (_) | (_) |   <| | |_| | | | |
|_.__/|_|  \___/ \___/|_|\_\_|\__, |_| |_|
                              |___/             0.8.0-incubating

2015-10-30 12:13:16,024 INFO  Starting Brooklyn web-console with passwordless access on localhost and protected access from any other interfaces (no bind address specified)
2015-10-30 12:13:18,200 INFO  Started Brooklyn console at http://127.0.0.1:8081/, running classpath://brooklyn.war
2015-10-30 12:13:18,215 INFO  Persistence disabled
2015-10-30 12:13:18,215 INFO  High availability disabled
2015-10-30 12:13:23,649 INFO  Launched Brooklyn; will now block until shutdown command received via GUI/API (recommended) or process interrupt.
2015-10-30 12:33:07,550 INFO  REST using security provider org.apache.brooklyn.rest.security.provider.BrooklynUserWithRandomPasswordSecurityProvider
2015-10-30 12:33:07,550 INFO  Allowing access to web console from localhost or with brooklyn:tPGOCP0C9z
2015-10-30 12:33:11,626 INFO  Geo info lookup for 127.0.0.1/127.0.0.1 returned: HostGeoInfo[Fastweb, Milan (IT): 127.0.0.1 at (45.46369934082,9.188099861145)]
2015-10-30 14:25:53,916 WARN  Request rcQs9T (GET /v1/server/up/extended from 127.0.0.1) failed: org.eclipse.jetty.io.EofException
org.eclipse.jetty.io.EofException: null
	at org.eclipse.jetty.http.HttpGenerator.flushBuffer(HttpGenerator.java:914) ~[org.eclipse.jetty-jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]
Caused by: java.nio.channels.ClosedChannelException: null
	at sun.nio.ch.SocketChannelImpl.ensureWriteOpen(SocketChannelImpl.java:268) ~[na:1.7.0_79]
2015-10-30 15:30:36,170 INFO  Launched from YAML: name: Nuro case study on the Cloud
location:
  byon:
    user: vagrant
    privateKeyFile: ./seaclouds_id_rsa
    hosts:
    - 192.168.100.12
    - 192.168.100.13

services:

- serviceType: org.apache.brooklyn.entity.software.base.VanillaSoftwareProcess
  brooklyn.config:
    launch.command: "true"
    stop.command: "true"
    checkRunning.command: "true"
    children.startable.mode: background_late
  brooklyn.children:
  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: PHP
    id: php
    provisioning.properties:
      stopIptables: true

    launch.command: |
      sudo apt-get update
      sudo apt-get -y install apache2 apache2-utils php5 php5-mysql libaio1 unzip 
      wget -O nurogames-seaclouds-casestudy-php.tgz "http://${USER}:${PASSWORD}@seaclouds-dev.nurogames.com/nuro-casestudy/versions/${VERSION}"
      sudo tar --directory=/var/www/html -xzf nurogames-seaclouds-casestudy-php.tgz
      sudo chmod -R 777 /var/www/html/nuro-casestudy
      cp '/var/www/html/nuro-casestudy/config/config_template.php' '/var/www/html/nuro-casestudy/config/config.php'
      sed -i "s/%host%/$HOST/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%database%/$DB_NAME/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%user%/$DB_USER/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%password%/$DB_PASSWORD/" /var/www/html/nuro-casestudy/config/config.php
      sudo service apache2 restart

    checkRunning.command: |
      sudo service apache2 status

    stop.command: |
      sudo service apache2 stop

    env:
      USER: seaclouds
      PASSWORD: preview
      VERSION: D6.3.2/nurogames-seaclouds-casestudy-php-D6.3.2v0.1_20150921_1543CET.tgz
      HOST: $brooklyn:component("db").attributeWhenReady("host.name")
      DB_NAME: "database1"
      DB_USER: "brooklyn"
      DB_PASSWORD: "br00k11n"

  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: DC
    id: nuro-dc
    launch.command: |
      sudo apt-get update
      sudo apt-get install -y openjdk-7-jre
      wget -O nuro-data-collector.jar https://www.dropbox.com/s/db6o4f4k5cgv16y/nuro-data-collector-0.8.0-SNAPSHOT-jar-with-dependencies.jar
      wget -O config.properties https://www.dropbox.com/s/pp22gk2g8o5gzte/config.properties
      nohup java -jar nuro-data-collector.jar ./config.properties > nuroDc.log 2>&1 &
      echo $! > $PID_FILE

    install.latch: $brooklyn:component("php").attributeWhenReady("service.isUp")
    
- serviceType: org.apache.brooklyn.entity.database.mysql.MySqlNode
  id: db
  name: Nuro DB
  brooklyn.config:
    datastore.creation.script.url: http://seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/create_db_and_tables-20150921_1543.sql -> BasicApplicationImpl{id=QBHE5Emi} (Task[start:iyMaVwOO])
2015-10-30 15:30:36,259 INFO  Starting VanillaSoftwareProcessImpl{id=obnhko5O}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=QksQkpc7, name=FixedListMachineProvisioningLocation:QksQ} with ports [22]
2015-10-30 15:30:36,259 INFO  Starting MySqlNodeImpl{id=BhIS25zv}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=QksQkpc7, name=FixedListMachineProvisioningLocation:QksQ} with ports [22, 3306]
2015-10-30 15:30:36,317 INFO  Starting MySqlNodeImpl{id=BhIS25zv} on machine SshMachineLocation[SshMachineLocation:vX7K:192.168.100.13/192.168.100.13:22@vX7K2YJ5]
2015-10-30 15:30:36,317 INFO  Starting VanillaSoftwareProcessImpl{id=obnhko5O} on machine SshMachineLocation[SshMachineLocation:zzw3:192.168.100.12/192.168.100.12:22@zzw3XPYe]
2015-10-30 15:30:38,832 INFO  Starting VanillaSoftwareProcessImpl{id=hyaIXWzl} on machine SshMachineLocation[SshMachineLocation:zzw3:192.168.100.12/192.168.100.12:22@zzw3XPYe]
2015-10-30 15:30:38,834 INFO  Starting VanillaSoftwareProcessImpl{id=tFYMWMOT} on machine SshMachineLocation[SshMachineLocation:zzw3:192.168.100.12/192.168.100.12:22@zzw3XPYe]
2015-10-30 15:31:21,826 WARN  Execution failed, invalid result 2 for launching VanillaSoftwareProcessImpl{id=tFYMWMOT} (throwing)
2015-10-30 15:31:21,826 INFO  STDERR of problem in Task[ssh: launching VanillaSoftwareProcessImpl{id=tFYMWMOT}:C83kJ45S]:
... frontend: Readline
debconf: (This frontend requires a controlling tty.)
debconf: falling back to frontend: Teletype
--2015-10-30 14:31:21--  http://seaclouds:*password*@seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/nurogames-seaclouds-casestudy-php-D6.3.2v0.1_20150921_1543CET.tgz
Resolving seaclouds-dev.nurogames.com (seaclouds-dev.nurogames.com)... 87.79.6.131
Connecting to seaclouds-dev.nurogames.com (seaclouds-dev.nurogames.com)|87.79.6.131|:80... connected.
HTTP request sent, awaiting response... 401 Authorization Required
Reusing existing connection to seaclouds-dev.nurogames.com:80.
HTTP request sent, awaiting response... 200 OK
Length: 10192 (10.0K) [application/x-gzip]
Saving to: `nurogames-seaclouds-casestudy-php.tgz'
     0K .........                                             100%  153K=0.07s
2015-10-30 14:31:21 (153 KB/s) - `nurogames-seaclouds-casestudy-php.tgz' saved [10192/10192]
tar: /var/www/html: Cannot open: No such file or directory
tar: Error is not recoverable: exiting now

2015-10-30 15:31:21,826 INFO  STDOUT of problem in Task[ssh: launching VanillaSoftwareProcessImpl{id=tFYMWMOT}:C83kJ45S]:
... ng module status.
Enabling module auth_basic.
Enabling module deflate.
Enabling module authz_default.
Enabling module authz_user.
Enabling module authz_groupfile.
Enabling module authn_file.
Enabling module authz_host.
Enabling module reqtimeout.
Setting up apache2-mpm-prefork (2.2.22-1ubuntu1.10) ...
 * Starting web server apache2
   ...done.
Setting up apache2 (2.2.22-1ubuntu1.10) ...
Setting up php5-common (5.3.10-1ubuntu3.21) ...
Setting up libapache2-mod-php5 (5.3.10-1ubuntu3.21) ...
 * Restarting web server apache2
 ... waiting    ...done.
Setting up php5 (5.3.10-1ubuntu3.21) ...
Setting up php5-cli (5.3.10-1ubuntu3.21) ...
update-alternatives: using /usr/bin/php5 to provide /usr/bin/php (php) in auto mode.
Setting up php5-mysql (5.3.10-1ubuntu3.21) ...
Setting up ssl-cert (1.0.28ubuntu0.1) ...
Setting up unzip (6.0-4ubuntu2.4) ...
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
Executed /tmp/brooklyn-20151030-153039111-fPTq-launching_VanillaSoftwareProce.sh, result 2

2015-10-30 15:31:21,826 INFO  STDIN of problem in Task[ssh: launching VanillaSoftwareProcessImpl{id=tFYMWMOT}:C83kJ45S]:
export RUN_DIR="/home/vagrant/brooklyn-managed-processes/apps/QBHE5Emi/entities/VanillaSoftwareProcess_tFYMWMOT"
mkdir -p $RUN_DIR
cd $RUN_DIR
sudo apt-get update
sudo apt-get -y install apache2 apache2-utils php5 php5-mysql libaio1 unzip 
wget -O nurogames-seaclouds-casestudy-php.tgz "http://${USER}:${PASSWORD}@seaclouds-dev.nurogames.com/nuro-casestudy/versions/${VERSION}"
sudo tar --directory=/var/www/html -xzf nurogames-seaclouds-casestudy-php.tgz
sudo chmod -R 777 /var/www/html/nuro-casestudy
cp '/var/www/html/nuro-casestudy/config/config_template.php' '/var/www/html/nuro-casestudy/config/config.php'
sed -i "s/%host%/$HOST/" /var/www/html/nuro-casestudy/config/config.php
sed -i "s/%database%/$DB_NAME/" /var/www/html/nuro-casestudy/config/config.php
sed -i "s/%user%/$DB_USER/" /var/www/html/nuro-casestudy/config/config.php
sed -i "s/%password%/$DB_PASSWORD/" /var/www/html/nuro-casestudy/config/config.php
sudo service apache2 restart

2015-10-30 15:31:21,832 WARN  Error invoking start at VanillaSoftwareProcessImpl{id=tFYMWMOT}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.IllegalStateException: Execution failed, invalid result 2 for launching VanillaSoftwareProcessImpl{id=tFYMWMOT}
2015-10-30 15:31:21,839 WARN  Error invoking start at VanillaSoftwareProcessImpl{id=hyaIXWzl}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.IllegalArgumentException: Error resolving config install.latch, $brooklyn:entity("php").attributeWhenReady("service.isUp"), in org.apache.brooklyn.util.core.task.BasicExecutionContext@5f0f46d6([Wrapped[contextEntity:VanillaSoftwareProcessImpl{id=hyaIXWzl}]]): org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.CompoundRuntimeException: Aborted waiting for ready from VanillaSoftwareProcessImpl{id=tFYMWMOT} Sensor: service.isUp (java.lang.Boolean): Aborted waiting for ready from VanillaSoftwareProcessImpl{id=tFYMWMOT} Sensor: service.isUp (java.lang.Boolean): java.lang.Exception: Abort due to VanillaSoftwareProcessImpl{id=tFYMWMOT} -> Sensor: service.state (org.apache.brooklyn.core.entity.lifecycle.Lifecycle)
2015-10-30 15:34:53,614 WARN  Error invoking start at BasicApplicationImpl{id=QBHE5Emi}: org.apache.brooklyn.util.exceptions.RuntimeInterruptedException: java.lang.InterruptedException
2015-10-30 15:34:53,624 WARN  Setting VanillaSoftwareProcessImpl{id=obnhko5O} on-fire due to problems when expected running, up=false, not-up-indicators: {service.process.isRunning=The software process for this entity does not appear to be running}
2015-10-30 15:34:53,624 WARN  Execution failed, invocation error for check-running VanillaSoftwareProcessImpl{id=obnhko5O}: (vagrant@192.168.100.12:22) (vagrant@192.168.100.12:22) error acquiring Put(path=[/tmp/brooklyn-20151030-153442352-mL0A-check-running_VanillaSoftwareP.sh 286]) (attempt 1/1, in time 11.3s/2m); out of retries: (vagrant@192.168.100.12:22) (vagrant@192.168.100.12:22) error acquiring SFTPClient() (attempt 1/1, in time 11.3s/2m); out of retries: null (throwing)
2015-10-30 15:34:53,624 INFO  STDIN of problem in Task[ssh: check-running VanillaSoftwareProcessImpl{id=obnhko5O}:T83p0VAc]:
export RUN_DIR="/home/vagrant/brooklyn-managed-processes/apps/QBHE5Emi/entities/VanillaSoftwareProcess_obnhko5O"
mkdir -p $RUN_DIR
cd $RUN_DIR
true
2015-10-30 15:36:35,403 INFO  Launched from YAML: name: Nuro case study on the Cloud
location:
  byon:
    user: vagrant
    privateKeyFile: ./seaclouds_id_rsa
    hosts:
    - 192.168.100.12
    - 192.168.100.13

services:

- serviceType: org.apache.brooklyn.entity.software.base.VanillaSoftwareProcess
  name: DC+PHP
  id: dc+php
  brooklyn.config:
    launch.command: "true"
    stop.command: "true"
    checkRunning.command: "true"
    children.startable.mode: background_late
  brooklyn.children:
  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: PHP
    id: php
    provisioning.properties:
      stopIptables: true

    launch.command: |
      sudo apt-get update
      sudo apt-get -y install apache2 apache2-utils php5 php5-mysql libaio1 unzip 
      wget -O nurogames-seaclouds-casestudy-php.tgz "http://${USER}:${PASSWORD}@seaclouds-dev.nurogames.com/nuro-casestudy/versions/${VERSION}"
      sudo mkdir /var/www/html
      sudo tar --directory=/var/www/html -xzf nurogames-seaclouds-casestudy-php.tgz
      sudo chmod -R 777 /var/www/html/nuro-casestudy
      cp '/var/www/html/nuro-casestudy/config/config_template.php' '/var/www/html/nuro-casestudy/config/config.php'
      sed -i "s/%host%/$HOST/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%database%/$DB_NAME/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%user%/$DB_USER/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%password%/$DB_PASSWORD/" /var/www/html/nuro-casestudy/config/config.php
      sudo service apache2 restart

    checkRunning.command: |
      sudo service apache2 status

    stop.command: |
      sudo service apache2 stop

    env:
      USER: seaclouds
      PASSWORD: preview
      VERSION: D6.3.2/nurogames-seaclouds-casestudy-php-D6.3.2v0.1_20150921_1543CET.tgz
      HOST: $brooklyn:component("db").attributeWhenReady("host.name")
      DB_NAME: "database1"
      DB_USER: "brooklyn"
      DB_PASSWORD: "br00k11n"

  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: DC
    id: dc
    launch.command: |
      sudo apt-get update
      sudo apt-get install -y openjdk-7-jre
      wget -O nuro-data-collector.jar https://www.dropbox.com/s/db6o4f4k5cgv16y/nuro-data-collector-0.8.0-SNAPSHOT-jar-with-dependencies.jar
      wget -O config.properties https://www.dropbox.com/s/pp22gk2g8o5gzte/config.properties
      nohup java -jar nuro-data-collector.jar ./config.properties > nuroDc.log 2>&1 &
      echo $! > $PID_FILE

    install.latch: $brooklyn:component("php").attributeWhenReady("service.isUp")

- serviceType: org.apache.brooklyn.entity.database.mysql.MySqlNode
  id: db
  name: Nuro DB
  brooklyn.config:
    datastore.creation.script.url: http://seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/create_db_and_tables-20150921_1543.sql -> BasicApplicationImpl{id=MWPPGT5Y} (Task[start:oP6RLxR0])
2015-10-30 15:36:35,415 INFO  Starting VanillaSoftwareProcessImpl{id=WdSYmyoG}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=K9j2AxWg, name=FixedListMachineProvisioningLocation:K9j2} with ports [22]
2015-10-30 15:36:35,420 INFO  Starting VanillaSoftwareProcessImpl{id=WdSYmyoG} on machine SshMachineLocation[SshMachineLocation:V45Y:192.168.100.12/192.168.100.12:22@V45YdsQx]
2015-10-30 15:36:35,424 INFO  Starting MySqlNodeImpl{id=XOYpbE8s}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=K9j2AxWg, name=FixedListMachineProvisioningLocation:K9j2} with ports [22, 3306]
2015-10-30 15:36:35,440 INFO  Starting MySqlNodeImpl{id=XOYpbE8s} on machine SshMachineLocation[SshMachineLocation:VpUm:192.168.100.13/192.168.100.13:22@VpUmWvLV]
2015-10-30 15:36:36,046 INFO  Starting VanillaSoftwareProcessImpl{id=kTjeU9fo} on machine SshMachineLocation[SshMachineLocation:V45Y:192.168.100.12/192.168.100.12:22@V45YdsQx]
2015-10-30 15:36:36,055 INFO  Starting VanillaSoftwareProcessImpl{id=Hq7G46CP} on machine SshMachineLocation[SshMachineLocation:V45Y:192.168.100.12/192.168.100.12:22@V45YdsQx]
2015-10-30 15:42:57,803 WARN  Error invoking start at MySqlNodeImpl{id=XOYpbE8s}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.RuntimeException: Error getting resource 'http://seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/create_db_and_tables-20150921_1543.sql' for MySqlNodeImpl{id=XOYpbE8s}: java.lang.IllegalStateException: Invalid response invoking http://seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/create_db_and_tables-20150921_1543.sql: response code 401
2015-10-30 15:42:57,824 WARN  Setting BasicApplicationImpl{id=MWPPGT5Y} on-fire due to problems when expected running, up=true, problems: {service-lifecycle-indicators-from-children-and-members=Required entity not healthy: MySqlNodeImpl{id=XOYpbE8s}}
2015-10-30 15:42:57,824 WARN  Error invoking start at BasicApplicationImpl{id=MWPPGT5Y}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: 1 of 2 parallel child tasks failed: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: Error invoking start at MySqlNodeImpl{id=XOYpbE8s}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.RuntimeException: Error getting resource 'http://seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/create_db_and_tables-20150921_1543.sql' for MySqlNodeImpl{id=XOYpbE8s}: java.lang.IllegalStateException: Invalid response invoking http://seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/create_db_and_tables-20150921_1543.sql: response code 401
2015-10-30 15:45:39,972 INFO  Launched from YAML: name: Nuro case study on the Cloud
location:
  byon:
    user: ubuntu
    privateKeyFile: ~/seaclouds.pem
    hosts:
    - 52.31.55.98
    - 52.31.55.68

services:

- serviceType: org.apache.brooklyn.entity.software.base.VanillaSoftwareProcess
  name: DC+PHP
  id: dc+php
  brooklyn.config:
    launch.command: "true"
    stop.command: "true"
    checkRunning.command: "true"
    children.startable.mode: background_late
  brooklyn.children:
  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: PHP
    id: php
    provisioning.properties:
      stopIptables: true

    launch.command: |
      sudo apt-get update
      sudo apt-get -y install apache2 apache2-utils php5 php5-mysql libaio1 unzip 
      wget -O nurogames-seaclouds-casestudy-php.tgz "http://${USER}:${PASSWORD}@seaclouds-dev.nurogames.com/nuro-casestudy/versions/${VERSION}"
      sudo mkdir /var/www/html
      sudo tar --directory=/var/www/html -xzf nurogames-seaclouds-casestudy-php.tgz
      sudo chmod -R 777 /var/www/html/nuro-casestudy
      cp '/var/www/html/nuro-casestudy/config/config_template.php' '/var/www/html/nuro-casestudy/config/config.php'
      sed -i "s/%host%/$HOST/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%database%/$DB_NAME/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%user%/$DB_USER/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%password%/$DB_PASSWORD/" /var/www/html/nuro-casestudy/config/config.php
      sudo service apache2 restart

    checkRunning.command: |
      sudo service apache2 status

    stop.command: |
      sudo service apache2 stop

    env:
      USER: seaclouds
      PASSWORD: preview
      VERSION: D6.3.2/nurogames-seaclouds-casestudy-php-D6.3.2v0.1_20150921_1543CET.tgz
      HOST: $brooklyn:component("db").attributeWhenReady("host.name")
      DB_NAME: "database1"
      DB_USER: "brooklyn"
      DB_PASSWORD: "br00k11n"

  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: DC
    id: dc
    launch.command: |
      sudo apt-get update
      sudo apt-get install -y openjdk-7-jre
      wget -O nuro-data-collector.jar https://www.dropbox.com/s/db6o4f4k5cgv16y/nuro-data-collector-0.8.0-SNAPSHOT-jar-with-dependencies.jar
      wget -O config.properties https://www.dropbox.com/s/pp22gk2g8o5gzte/config.properties
      nohup java -jar nuro-data-collector.jar ./config.properties > nuroDc.log 2>&1 &
      echo $! > $PID_FILE

    install.latch: $brooklyn:component("php").attributeWhenReady("service.isUp")

- serviceType: org.apache.brooklyn.entity.database.mysql.MySqlNode
  id: db
  name: Nuro DB
  brooklyn.config:
    datastore.creation.script.url: ./create.sql -> BasicApplicationImpl{id=HtjIZ7XZ} (Task[start:Wg5hkEEp])
2015-10-30 15:45:39,987 INFO  Starting VanillaSoftwareProcessImpl{id=msWB8DPy}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=PfviE1EX, name=FixedListMachineProvisioningLocation:Pfvi} with ports [22]
2015-10-30 15:45:39,993 INFO  Starting VanillaSoftwareProcessImpl{id=msWB8DPy} on machine SshMachineLocation[SshMachineLocation:SlSb:52.31.55.98/52.31.55.98:22@SlSbDEAT]
2015-10-30 15:45:39,996 INFO  Starting MySqlNodeImpl{id=Vhs7IqwD}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=PfviE1EX, name=FixedListMachineProvisioningLocation:Pfvi} with ports [22, 3306]
2015-10-30 15:45:39,997 INFO  Starting MySqlNodeImpl{id=Vhs7IqwD} on machine SshMachineLocation[SshMachineLocation:uXeq:52.31.55.68/52.31.55.68:22@uXeqntFQ]
2015-10-30 15:45:53,339 INFO  Starting VanillaSoftwareProcessImpl{id=kyGNPLVw} on machine SshMachineLocation[SshMachineLocation:SlSb:52.31.55.98/52.31.55.98:22@SlSbDEAT]
2015-10-30 15:45:53,343 INFO  Starting VanillaSoftwareProcessImpl{id=iFNkFeuK} on machine SshMachineLocation[SshMachineLocation:SlSb:52.31.55.98/52.31.55.98:22@SlSbDEAT]
2015-10-30 15:46:22,529 WARN  Execution failed, invalid result 1 for launching VanillaSoftwareProcessImpl{id=iFNkFeuK} (throwing)
2015-10-30 15:46:22,529 INFO  STDERR of problem in Task[ssh: launching VanillaSoftwareProcessImpl{id=iFNkFeuK}:zJ3NICKp]:
... API
php5_invoke mysqli: already enabled for apache2 SAPI
apache2_switch_mpm Switch to prefork
apache2_invoke: Enable module php5
--2015-10-30 14:46:22--  http://seaclouds:*password*@seaclouds-dev.nurogames.com/nuro-casestudy/versions/D6.3.2/nurogames-seaclouds-casestudy-php-D6.3.2v0.1_20150921_1543CET.tgz
Resolving seaclouds-dev.nurogames.com (seaclouds-dev.nurogames.com)... 87.79.6.131
Connecting to seaclouds-dev.nurogames.com (seaclouds-dev.nurogames.com)|87.79.6.131|:80... connected.
HTTP request sent, awaiting response... 401 Authorization Required
Reusing existing connection to seaclouds-dev.nurogames.com:80.
HTTP request sent, awaiting response... 200 OK
Length: 10192 (10.0K) [application/x-gzip]
Saving to: Ã¢ÂÂnurogames-seaclouds-casestudy-php.tgzÃ¢ÂÂ
     0K .........                                             100%  102K=0.1s
2015-10-30 14:46:22 (102 KB/s) - Ã¢ÂÂnurogames-seaclouds-casestudy-php.tgzÃ¢ÂÂ saved [10192/10192]
mkdir: cannot create directory Ã¢ÂÂ/var/www/htmlÃ¢ÂÂ: File exists

2015-10-30 15:46:22,529 INFO  STDOUT of problem in Task[ssh: launching VanillaSoftwareProcessImpl{id=iFNkFeuK}:zJ3NICKp]:
... rve-cgi-bin.
Enabling site 000-default.
 * Starting web server apache2
 *
Setting up apache2-utils (2.4.7-1ubuntu4.8) ...
Setting up ssl-cert (1.0.33) ...
Setting up unzip (6.0-9ubuntu1.4) ...
Setting up php5-common (5.5.9+dfsg-1ubuntu4.14) ...
Setting up php5-mysql (5.5.9+dfsg-1ubuntu4.14) ...
Setting up php5-cli (5.5.9+dfsg-1ubuntu4.14) ...
update-alternatives: using /usr/bin/php5 to provide /usr/bin/php (php) in auto mode
Setting up php5-readline (5.5.9+dfsg-1ubuntu4.14) ...
Setting up php5-json (1.3.2-2build1) ...
Processing triggers for ureadahead (0.100.0-16) ...
Processing triggers for ufw (0.34~rc-0ubuntu2) ...
Setting up libapache2-mod-php5 (5.5.9+dfsg-1ubuntu4.14) ...
Module mpm_event disabled.
Enabling module mpm_prefork.
 * Restarting web server apache2
   ...done.
 * Restarting web server apache2
   ...done.
Setting up php5 (5.5.9+dfsg-1ubuntu4.14) ...
Processing triggers for libc-bin (2.19-0ubuntu6.6) ...
Executed /tmp/brooklyn-20151030-154554099-ofSp-launching_VanillaSoftwareProce.sh, result 1

2015-10-30 15:46:22,529 INFO  STDIN of problem in Task[ssh: launching VanillaSoftwareProcessImpl{id=iFNkFeuK}:zJ3NICKp]:
export RUN_DIR="/home/ubuntu/brooklyn-managed-processes/apps/HtjIZ7XZ/entities/VanillaSoftwareProcess_iFNkFeuK"
mkdir -p $RUN_DIR
cd $RUN_DIR
sudo apt-get update
sudo apt-get -y install apache2 apache2-utils php5 php5-mysql libaio1 unzip 
wget -O nurogames-seaclouds-casestudy-php.tgz "http://${USER}:${PASSWORD}@seaclouds-dev.nurogames.com/nuro-casestudy/versions/${VERSION}"
sudo mkdir /var/www/html
sudo tar --directory=/var/www/html -xzf nurogames-seaclouds-casestudy-php.tgz
sudo chmod -R 777 /var/www/html/nuro-casestudy
cp '/var/www/html/nuro-casestudy/config/config_template.php' '/var/www/html/nuro-casestudy/config/config.php'
sed -i "s/%host%/$HOST/" /var/www/html/nuro-casestudy/config/config.php
sed -i "s/%database%/$DB_NAME/" /var/www/html/nuro-casestudy/config/config.php
sed -i "s/%user%/$DB_USER/" /var/www/html/nuro-casestudy/config/config.php
sed -i "s/%password%/$DB_PASSWORD/" /var/www/html/nuro-casestudy/config/config.php
sudo service apache2 restart

2015-10-30 15:46:22,532 WARN  Error invoking start at VanillaSoftwareProcessImpl{id=iFNkFeuK}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.IllegalStateException: Execution failed, invalid result 1 for launching VanillaSoftwareProcessImpl{id=iFNkFeuK}
2015-10-30 15:46:22,538 WARN  Error invoking start at VanillaSoftwareProcessImpl{id=kyGNPLVw}: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.IllegalArgumentException: Error resolving config install.latch, $brooklyn:entity("php").attributeWhenReady("service.isUp"), in org.apache.brooklyn.util.core.task.BasicExecutionContext@6e136311([Wrapped[contextEntity:VanillaSoftwareProcessImpl{id=kyGNPLVw}]]): org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: org.apache.brooklyn.util.exceptions.CompoundRuntimeException: Aborted waiting for ready from VanillaSoftwareProcessImpl{id=iFNkFeuK} Sensor: service.isUp (java.lang.Boolean): Aborted waiting for ready from VanillaSoftwareProcessImpl{id=iFNkFeuK} Sensor: service.isUp (java.lang.Boolean): java.lang.Exception: Abort due to VanillaSoftwareProcessImpl{id=iFNkFeuK} -> Sensor: service.state (org.apache.brooklyn.core.entity.lifecycle.Lifecycle)
2015-10-30 15:47:17,056 INFO  Started application BasicApplicationImpl{id=HtjIZ7XZ}
2015-10-30 15:53:59,623 WARN  Read of MySqlNodeImpl{id=Vhs7IqwD}->Sensor: service.process.isRunning (java.lang.Boolean) gave failure: org.apache.brooklyn.feed.ssh.SshPollValue@79dfa28e
2015-10-30 15:53:59,624 WARN  Setting MySqlNodeImpl{id=Vhs7IqwD} on-fire due to problems when expected running, up=false, not-up-indicators: {service.process.isRunning=The software process for this entity does not appear to be running}
2015-10-30 15:53:59,625 WARN  Setting BasicApplicationImpl{id=HtjIZ7XZ} on-fire due to problems when expected running, up=true, problems: {service-lifecycle-indicators-from-children-and-members=Required entity not healthy: MySqlNodeImpl{id=Vhs7IqwD}}
2015-10-30 15:54:12,346 WARN  Execution failed, invocation error for check-running VanillaSoftwareProcessImpl{id=msWB8DPy}: (ubuntu@52.31.55.98:22) failed to connect: (ubuntu@52.31.55.98:22) (ubuntu@52.31.55.98:22) error acquiring {hostAndPort=52.31.55.98:22, user=ubuntu, ssh=98246604, password=null, privateKeyFile=/home/micheleguerriero/seaclouds.pem, privateKey=null, connectTimeout=10000, sessionTimeout=30000} (attempt 1/1, in time 10.01s/2m); out of retries: connect timed out (throwing)
2015-10-30 15:54:12,346 INFO  STDIN of problem in Task[ssh: check-running VanillaSoftwareProcessImpl{id=msWB8DPy}:vnKEaa8l]:
export RUN_DIR="/home/ubuntu/brooklyn-managed-processes/apps/HtjIZ7XZ/entities/VanillaSoftwareProcess_msWB8DPy"
mkdir -p $RUN_DIR
cd $RUN_DIR
true
2015-10-30 15:54:12,348 WARN  Read of VanillaSoftwareProcessImpl{id=msWB8DPy}->Sensor: service.process.isRunning (java.lang.Boolean) gave exception: org.apache.brooklyn.util.exceptions.PropagatedRuntimeException: java.lang.IllegalStateException: Execution failed, invocation error for check-running VanillaSoftwareProcessImpl{id=msWB8DPy}: (ubuntu@52.31.55.98:22) failed to connect: (ubuntu@52.31.55.98:22) (ubuntu@52.31.55.98:22) error acquiring {hostAndPort=52.31.55.98:22, user=ubuntu, ssh=98246604, password=null, privateKeyFile=/home/micheleguerriero/seaclouds.pem, privateKey=null, connectTimeout=10000, sessionTimeout=30000} (attempt 1/1, in time 10.01s/2m); out of retries: connect timed out: Execution failed, invocation error for check-running VanillaSoftwareProcessImpl{id=msWB8DPy}: (ubuntu@52.31.55.98:22) failed to connect: (ubuntu@52.31.55.98:22) (ubuntu@52.31.55.98:22) error acquiring {hostAndPort=52.31.55.98:22, user=ubuntu, ssh=98246604, password=null, privateKeyFile=/home/micheleguerriero/seaclouds.pem, privateKey=null, connectTimeout=10000, sessionTimeout=30000} (attempt 1/1, in time 10.01s/2m); out of retries: connect timed out: org.apache.brooklyn.util.core.internal.ssh.SshException: (ubuntu@52.31.55.98:22) failed to connect: (ubuntu@52.31.55.98:22) (ubuntu@52.31.55.98:22) error acquiring {hostAndPort=52.31.55.98:22, user=ubuntu, ssh=98246604, password=null, privateKeyFile=/home/micheleguerriero/seaclouds.pem, privateKey=null, connectTimeout=10000, sessionTimeout=30000} (attempt 1/1, in time 10.01s/2m); out of retries: connect timed out
2015-10-30 15:54:12,350 WARN  Setting VanillaSoftwareProcessImpl{id=msWB8DPy} on-fire due to problems when expected running, up=false, not-up-indicators: {service.process.isRunning=The software process for this entity does not appear to be running}
2015-10-30 15:54:27,363 WARN  Execution failed, invocation error for check-running VanillaSoftwareProcessImpl{id=msWB8DPy}: java.lang.InterruptedException (throwing)
2015-10-30 15:54:27,363 INFO  STDIN of problem in Task[ssh: check-running VanillaSoftwareProcessImpl{id=msWB8DPy}:Q8JXiNmq]:
export RUN_DIR="/home/ubuntu/brooklyn-managed-processes/apps/HtjIZ7XZ/entities/VanillaSoftwareProcess_msWB8DPy"
mkdir -p $RUN_DIR
cd $RUN_DIR
true
2015-10-30 15:58:59,070 INFO  Launched from YAML: name: Nuro case study on the Cloud
location:
  byon:
    user: ubuntu
    privateKeyFile: ~/seaclouds.pem
    hosts:
    - 52.31.1.222
    - 52.30.247.159

services:

- serviceType: org.apache.brooklyn.entity.software.base.VanillaSoftwareProcess
  name: DC+PHP
  id: dc+php
  brooklyn.config:
    launch.command: "true"
    stop.command: "true"
    checkRunning.command: "true"
    children.startable.mode: background_late
  brooklyn.children:
  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: PHP
    id: php
    provisioning.properties:
      stopIptables: true

    launch.command: |
      sudo apt-get update
      sudo apt-get -y install apache2 apache2-utils php5 php5-mysql libaio1 unzip 
      wget -O nurogames-seaclouds-casestudy-php.tgz "http://${USER}:${PASSWORD}@seaclouds-dev.nurogames.com/nuro-casestudy/versions/${VERSION}"
      sudo tar --directory=/var/www/html -xzf nurogames-seaclouds-casestudy-php.tgz
      sudo chmod -R 777 /var/www/html/nuro-casestudy
      cp '/var/www/html/nuro-casestudy/config/config_template.php' '/var/www/html/nuro-casestudy/config/config.php'
      sed -i "s/%host%/$HOST/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%database%/$DB_NAME/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%user%/$DB_USER/" /var/www/html/nuro-casestudy/config/config.php
      sed -i "s/%password%/$DB_PASSWORD/" /var/www/html/nuro-casestudy/config/config.php
      sudo service apache2 restart

    checkRunning.command: |
      sudo service apache2 status

    stop.command: |
      sudo service apache2 stop

    env:
      USER: seaclouds
      PASSWORD: preview
      VERSION: D6.3.2/nurogames-seaclouds-casestudy-php-D6.3.2v0.1_20150921_1543CET.tgz
      HOST: $brooklyn:component("db").attributeWhenReady("host.name")
      DB_NAME: "database1"
      DB_USER: "brooklyn"
      DB_PASSWORD: "br00k11n"

  - serviceType: brooklyn.entity.basic.VanillaSoftwareProcess
    name: DC
    id: dc
    launch.command: |
      sudo apt-get update
      sudo apt-get install -y openjdk-7-jre
      wget -O nuro-data-collector.jar https://www.dropbox.com/s/db6o4f4k5cgv16y/nuro-data-collector-0.8.0-SNAPSHOT-jar-with-dependencies.jar
      wget -O config.properties https://www.dropbox.com/s/pp22gk2g8o5gzte/config.properties
      nohup java -jar nuro-data-collector.jar ./config.properties > nuroDc.log 2>&1 &
      echo $! > $PID_FILE

    install.latch: $brooklyn:component("php").attributeWhenReady("service.isUp")

- serviceType: org.apache.brooklyn.entity.database.mysql.MySqlNode
  id: db
  name: Nuro DB
  brooklyn.config:
    datastore.creation.script.url: ./create.sql -> BasicApplicationImpl{id=RrsP8rMh} (Task[start:ykoPIlxO])
2015-10-30 15:58:59,089 INFO  Starting VanillaSoftwareProcessImpl{id=Y9cN44sP}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=VX5J6OHX, name=FixedListMachineProvisioningLocation:VX5J} with ports [22]
2015-10-30 15:58:59,093 INFO  Starting MySqlNodeImpl{id=OqLacrjt}, obtaining a new location instance in FixedListMachineProvisioningLocation{id=VX5J6OHX, name=FixedListMachineProvisioningLocation:VX5J} with ports [22, 3306]
2015-10-30 15:58:59,095 INFO  Starting VanillaSoftwareProcessImpl{id=Y9cN44sP} on machine SshMachineLocation[SshMachineLocation:leiu:52.31.1.222/52.31.1.222:22@leiuyZso]
2015-10-30 15:58:59,097 INFO  Starting MySqlNodeImpl{id=OqLacrjt} on machine SshMachineLocation[SshMachineLocation:bU1g:52.30.247.159/52.30.247.159:22@bU1g47Vd]
2015-10-30 15:59:09,603 INFO  Starting VanillaSoftwareProcessImpl{id=AHcRzwEB} on machine SshMachineLocation[SshMachineLocation:leiu:52.31.1.222/52.31.1.222:22@leiuyZso]
2015-10-30 15:59:09,603 INFO  Starting VanillaSoftwareProcessImpl{id=D9TeVO6E} on machine SshMachineLocation[SshMachineLocation:leiu:52.31.1.222/52.31.1.222:22@leiuyZso]
2015-10-30 16:00:27,335 INFO  Started application BasicApplicationImpl{id=RrsP8rMh}
2015-10-30 16:02:21,885 WARN  Setting VanillaSoftwareProcessImpl{id=Y9cN44sP} on-fire due to problems when expected running, up=false, not-up-indicators: {service.process.isRunning=The software process for this entity does not appear to be running}
2015-10-30 16:02:21,897 WARN  Execution failed, invocation error for check-running VanillaSoftwareProcessImpl{id=Y9cN44sP}: (ubuntu@52.31.1.222:22) (ubuntu@52.31.1.222:22) error acquiring Put(path=[/tmp/brooklyn-20151030-160221426-bu64-check-running_VanillaSoftwareP.sh 284]) (attempt 1/1, in time 458ms/2m); out of retries: null (throwing)
2015-10-30 16:02:21,897 INFO  STDIN of problem in Task[ssh: check-running VanillaSoftwareProcessImpl{id=Y9cN44sP}:Zs4k1xhb]:
export RUN_DIR="/home/ubuntu/brooklyn-managed-processes/apps/RrsP8rMh/entities/VanillaSoftwareProcess_Y9cN44sP"
mkdir -p $RUN_DIR
cd $RUN_DIR
true
